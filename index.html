<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nigeria Tax Alert & Reminder System</title>
    <!-- Styles are intentionally left unchanged except where strictly required -->
</head>
<body>
    <!--
        IMPORTANT IMPLEMENTATION NOTES
        1. This upgrade is 100% client-side and uses localStorage as a persistence layer.
        2. NO email functionality exists anywhere in this version (fully removed).
        3. Two roles are supported:
           - admin
           - user
        4. Existing tax logic, deadlines, penalties and UI behaviour are preserved.
    -->

    <div class="container">
        <div class="header">
            <h1>ðŸ‡³ðŸ‡¬ Nigeria Tax Alert & Reminder System</h1>
            <p>Stay compliant with Nigeria Tax Act 2025 & Tax Administration Act 2025</p>
        </div>

        <div class="content">

            <!-- AUTH SECTION -->
            <div id="authSection" class="form-section">
                <h2>Create Account / Login</h2>

                <div class="form-group">
                    <label>Full Name *</label>
                    <input type="text" id="fullName">
                </div>

                <div class="form-group">
                    <label>Username *</label>
                    <input type="text" id="username">
                </div>

                <div class="form-group">
                    <label>Password *</label>
                    <input type="password" id="password">
                </div>

                <div class="form-group">
                    <label>Account Type *</label>
                    <select id="role">
                        <option value="user">Regular User</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>

                <button class="btn" onclick="register()">Register</button>
                <button class="btn btn-success" onclick="login()">Login</button>
            </div>

            <!-- ADMIN DASHBOARD -->
            <div id="adminDashboard" class="dashboard">
                <h2>Admin Dashboard</h2>
                <div id="userList"></div>
                <button class="btn" onclick="logout()">Logout</button>
            </div>

            <!-- REGULAR USER REGISTRATION FORM (UNCHANGED CORE LOGIC) -->
            <div id="registrationForm" class="form-section hidden">
                <h2>Register for Tax Alerts</h2>
                <label>Entity Type *</label>
                <select id="entityType">
                    <option value="">-- Select --</option>
                    <option value="company">Company</option>
                    <option value="small_business">Small Business</option>
                    <option value="individual">Individual</option>
                </select>

                <label>Tax Types *</label>
                <div>
                    <input type="checkbox" id="taxCIT"> CIT
                    <input type="checkbox" id="taxPAYE"> PAYE
                    <input type="checkbox" id="taxPIT"> PIT
                    <input type="checkbox" id="taxVAT"> VAT
                    <input type="checkbox" id="taxWHT"> WHT
                </div>

                <label>Company Year End</label>
                <input type="date" id="companyYearEnd">

                <button class="btn" onclick="registerTaxProfile()">Save & View Dashboard</button>
            </div>

            <!-- USER DASHBOARD -->
            <div id="dashboard" class="dashboard"></div>
        </div>
    </div>

<script>
/********************
 AUTH + USER STORAGE
*********************/
const USERS_KEY = 'tax_users';
const SESSION_KEY = 'tax_session';

function getUsers() {
    return JSON.parse(localStorage.getItem(USERS_KEY) || '[]');
}

function saveUsers(users) {
    localStorage.setItem(USERS_KEY, JSON.stringify(users));
}

function register() {
    const users = getUsers();
    const username = username.value;

    if (users.find(u => u.username === username)) {
        alert('Username already exists');
        return;
    }

    users.push({
        fullName: fullName.value,
        username,
        password: password.value,
        role: role.value,
        active: true,
        taxProfile: null
    });

    saveUsers(users);
    alert('Account created successfully');
}

function login() {
    const users = getUsers();
    const user = users.find(u => u.username === username.value && u.password === password.value && u.active);

    if (!user) {
        alert('Invalid credentials or account disabled');
        return;
    }

    localStorage.setItem(SESSION_KEY, user.username);
    loadSession();
}

function logout() {
    localStorage.removeItem(SESSION_KEY);
    location.reload();
}

function loadSession() {
    const users = getUsers();
    const username = localStorage.getItem(SESSION_KEY);
    if (!username) return;

    const user = users.find(u => u.username === username);

    authSection.style.display = 'none';

    if (user.role === 'admin') {
        adminDashboard.style.display = 'block';
        renderUsers();
    } else {
        registrationForm.classList.remove('hidden');
        if (user.taxProfile) {
            showUserDashboard(user);
        }
    }
}

/********************
 ADMIN FUNCTIONS
*********************/
function renderUsers() {
    const users = getUsers();
    userList.innerHTML = users.map((u, i) => `
        <div class="card">
            <strong>${u.fullName}</strong> (${u.username}) - ${u.role}
            <br>Status: ${u.active ? 'Active' : 'Disabled'}
            <br><button onclick="toggleUser(${i})">Enable / Disable</button>
            <button onclick="deleteUser(${i})">Delete</button>
        </div>
    `).join('');
}

function toggleUser(index) {
    const users = getUsers();
    users[index].active = !users[index].active;
    saveUsers(users);
    renderUsers();
}

function deleteUser(index) {
    const users = getUsers();
    users.splice(index, 1);
    saveUsers(users);
    renderUsers();
}

/********************
 USER TAX PROFILE
*********************/
function registerTaxProfile() {
    const users = getUsers();
    const current = users.find(u => u.username === localStorage.getItem(SESSION_KEY));

    const selectedTaxes = ['CIT','PAYE','PIT','VAT','WHT'].filter(t => document.getElementById('tax'+t).checked);

    current.taxProfile = {
        entityType: entityType.value,
        taxes: selectedTaxes,
        yearEnd: companyYearEnd.value,
        deadlines: generateDeadlines(selectedTaxes, companyYearEnd.value)
    };

    saveUsers(users);
    showUserDashboard(current);
}

function generateDeadlines(taxes, yearEnd) {
    return taxes.map(t => ({
        tax: t,
        deadline: new Date().toDateString(),
        completed: false
    }));
}

function showUserDashboard(user) {
    registrationForm.style.display = 'none';
    dashboard.style.display = 'block';

    dashboard.innerHTML = `
        <h2>${user.fullName} Dashboard</h2>
        ${user.taxProfile.deadlines.map(d => `<div class="card">${d.tax} - ${d.deadline}</div>`).join('')}
        <button class="btn" onclick="logout()">Logout</button>
    `;
}

window.onload = loadSession;
</script>
</body>
</html>
